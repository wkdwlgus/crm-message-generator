import os
from typing import Dict, List
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    OPENAI_API_KEY: str
    
    # Supabase Settings
    SUPABASE_URL: str
    SUPABASE_KEY: str

    class Config:
        env_file = ".env"

settings = Settings()

# ============================================================================
# Cross-Encoder 및 추천 시스템 설정
# ============================================================================

TOP_K = 3
CANDIDATE_POOL = 30
EMBED_MODEL = "text-embedding-3-small"
EMBED_DIM = 1536
CE_MODEL = "BAAI/bge-reranker-v2-m3"
KW_BONUS_ALPHA = 1.2
CUSTOMER_ID_COL = "user_id"
PRODUCT_VECTOR_FK_COL = "product_id"

# ============================================================================
# 동의어 매핑
# ============================================================================

SKIN_TYPE_MAP: Dict[str, str] = {
    "Sensitive": "민감성",
    "Dry": "건성",
    "Oily": "지성",
    "Combination": "복합성",
    "Neutral": "중성",
    "Normal": "중성",
}

CONCERN_MAP: Dict[str, str] = {
    "Pores": "모공",
    "Sebum": "피지",
    "Acne": "여드름",
    "Redness": "홍조",
    "Dryness": "건조",
    "Wrinkle": "주름",
    "Elasticity": "탄력",
    "Dullness": "칙칙함",
    "Anti-aging": "안티에이징",
    "Antiaging": "안티에이징",
    "Sensitive": "민감",
    "Sensitivity": "민감",
}

TONE_MAP: Dict[str, str] = {
    "Cool_Summer": "쿨톤 여름",
    "Cool_Winter": "쿨톤 겨울",
    "Warm_Spring": "웜톤 봄",
    "Warm_Autumn": "웜톤 가을",
    "Neutral": "뉴트럴",
}

# ============================================================================
# 영어 키워드 -> 한글 동의어 매핑 (키워드 매칭률 개선)
# ============================================================================

KEYWORD_TRANSLATION: Dict[str, List[str]] = {
    # 효능 키워드
    "antiaging": ["안티에이징", "안티", "주름", "주름개선", "주름케어", "탄력", "탄력케어", "탄력개선", "어려보이는", "항산화", "리프팅", "노화", "안티에이지", "개선효과"],
    "anti_aging": ["안티에이징", "안티", "주름", "주름개선", "주름케어", "탄력", "탄력케어", "탄력개선", "어려보이는", "항산화", "리프팅", "노화", "개선효과"],
    "firming": ["탄력", "탄력케어", "탄력개선", "리프팅", "퍼밍", "탄탄", "elasticity", "firmness", "긴장", "피부탄력"],
    "whitening": ["화이트닝", "미백", "브라이트닝", "톤업", "brightening", "브라이트", "화사", "피부톤", "톤개선"],
    "brightening": ["브라이트닝", "화이트닝", "미백", "톤업", "화사", "피부톤", "밝은"],
    "nutrition": ["영양", "nutrition", "영양감", "영양공급", "영양크림", "nourishing"],
    "moisturizing": ["보습", "보습감", "보습력", "수분", "수분감", "수분공급", "촉촉", "촉촉한", "hydrating", "하이드레이팅", "moisturize"],
    "hydrating": ["수분", "수분감", "수분공급", "보습", "보습감", "촉촉", "촉촉한"],
    "nourishing": ["영양", "영양감", "영양공급", "영양크림"],
    "exfoliating": ["각질", "각질제거", "각질케어", "각질관리", "peeling", "필링"],
    "peeling": ["필링", "각질제거", "각질케어", "각질"],
    "soothing": ["진정", "수딩", "편안", "편안한", "calm", "calming", "진정효과"],
    "calming": ["진정", "수딩", "편안", "편안한", "calm"],
    
    # 피부타입/고민
    "sensitive": ["민감", "민감성", "순한", "자극없는", "gentle", "센시티브", "민감성피부", "민감피부"],
    "acne": ["여드름", "트러블", "아크네", "피지", "모공", "trouble"],
    "pore": ["모공", "pore", "피지", "블랙헤드", "모공케어"],
    "sebum": ["피지", "유분", "sebum", "오일", "유분조절"],
    "dry": ["건조", "건성", "수분부족", "건조함"],
    "oily": ["지성", "유분", "피지", "오일리"],
    
    # 품질/등급
    "premium": ["프리미엄", "고급", "고급스러운", "럭셔리", "명품", "최고급"],
    "luxury": ["럭셔리", "고급", "프리미엄", "명품"],
    "glow": ["광채", "윤기", "빛나는", "글로우", "radiance", "래디언스", "빛", "생기", "피부톤", "톤", "톤개선"],
    "radiance": ["래디언스", "광채", "윤기", "빛나는", "생기"],
    "dermatologisttested": ["피부과", "임상", "테스트", "dermatologist", "피부과테스트", "전문가"],
    "dermatologist_tested": ["피부과", "임상", "테스트", "전문가", "피부과테스트"],
    
    # 텍스처/사용감
    "lightweight": ["가벼운", "가벼운사용감", "가벼운텍스처", "가벼운제형", "light"],
    "light": ["가벼운", "가볍고", "가벼운사용감"],
    "soft": ["부드러운", "soft", "소프트", "부드럽게"],
    "gentle": ["순한", "부드러운", "자극없는", "젠틀"],
    "rich": ["풍부한", "농축", "진한", "리치"],
    "creamy": ["크리미한", "부드러운", "크림같은", "크림"],
    "absorption": ["흡수", "흡수력", "스며듦", "빠른흡수"],
    "nonsticky": ["끈적임없는", "산뜻한", "가벼운"],
    "nondrying": ["건조하지않은", "촉촉한", "보습"],
    
    # 가격/가성비
    "affordable": ["가성비", "가격저렴한", "합리적", "가격대비", "저렴"],
    "valueformoney": ["가성비", "가격대비", "가성비좋은"],
    "value_for_money": ["가성비", "가격대비", "합리적"],
}

# ============================================================================
# 날씨/시즌별 제품 키워드 매핑
# ============================================================================

WEATHER_KEYWORDS: Dict[str, List[str]] = {
    "spring": [
        "봄", "미세먼지", "황사", "꽃가루", "알러지", "알레르기", "진정", "보호", "보호막", 
        "배리어", "클렌징", "세안", "딥클렌징", "민감", "민감성", "자극완화", "순한", 
        "저자극", "항산화", "비타민C", "진정효과", "피부진정", "피부보호"
    ],
    "summer": [
        "여름", "폭염", "자외선", "장마", "습도", "UV", "SPF", "PA", "선크림", "썬", 
        "선케어", "쿨링", "시원한", "산뜻한", "가벼운", "땀", "피지", "모공", "유분", 
        "지성", "수분", "젤", "에센스", "자외선차단", "유분조절", "모공케어", "피지조절", 
        "청량", "청량감", "가벼운제형", "산뜻한발림성"
    ],
    "fall": [
        "가을", "환절기", "일교차", "건조", "건조한", "보습", "수분", "진정", "밸런스", 
        "장벽", "배리어", "회복", "리페어", "영양", "케어", "피부장벽", "세라마이드", 
        "히알루론산", "크림", "보습감", "탄력", "촉촉한", "부드러운", "영양공급", 
        "장벽리페어", "피부밀도", "밀도"
    ],
    "winter": [
        "겨울", "한파", "건조", "극건조", "보습", "고보습", "수분", "크림", "오일", "밤", 
        "농축", "리치", "영양", "영양크림", "리프팅", "탄력", "밀착", "피부장벽", 
        "세라마이드", "촉촉한보습감", "부드러운발림성", "장벽리페어", "피부밀도", "밀도"
    ]
}

# ============================================================================
# 계절별 핵심 키워드 (우선순위 2배 가중치 적용)
# ============================================================================

WEATHER_PRIORITY_KEYWORDS: Dict[str, List[str]] = {
    "spring": [
        # 미세먼지/황사 대응
        "진정", "민감", "순한", "저자극", "보호", "배리어", "피부보호",
        "클렌징", "딥클렌징", "세안",
        "알러지", "알레르기", "자극완화", "진정효과", "피부진정"
    ],
    "summer": [
        # 땀/피지 관리 + 자외선 차단
        "산뜻", "산뜻한", "가벼운", "끈적임없는", "논스티키", "쿨링", "시원한",
        "SPF", "PA", "자외선", "자외선차단", "선크림", "선케어", "UV",
        "피지", "피지조절", "모공", "모공케어", "유분조절", "지성",
        "젤", "청량", "청량감", "가벼운제형", "산뜻한발림성"
    ],
    "fall": [
        # 환절기 건조 + 피부장벽
        "보습", "수분", "촉촉", "촉촉한", "건조",
        "장벽", "배리어", "피부장벽", "장벽리페어", "회복", "리페어",
        "진정", "밸런스", "영양", "영양공급",
        "세라마이드", "히알루론산"
    ],
    "winter": [
        # 극건조 대응 + 고보습
        "보습", "고보습", "수분", "극건조", "건조",
        "크림", "리치", "농축", "밀착", "오일", "밤",
        "영양", "영양크림", "영양공급",
        "촉촉한보습감", "부드러운발림성",
        "세라마이드", "피부장벽", "장벽리페어"
    ]
}
